<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Playground</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <link href="css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
    </style>
    <script src="js/dust-full-0.3.0.min.js"></script>
    <script src="js/jquery-1.7.2.min.js"></script>
    <link href="css/bootstrap-responsive.css" rel="stylesheet">
    <link href="css/main.css" rel="stylesheet">

    <script type="text/javascript">
        $(document).ready(function() {
          
          //load nav bar template
          $.get('tl/navBar.tl', function(data) {
            var compiled = dust.compile(data, "navBarTemplate");
            dust.loadSource(compiled);
            var page = window.location.pathname;
            var lastIndex = page.lastIndexOf('/');
            page = page.substr(lastIndex + 1);
            
            var pointIndex = page.lastIndexOf('.');
            if (pointIndex != -1) {
              page = page.substr(0, pointIndex); 
            }

            var templateData = {};
            templateData[page] = "true";

            dust.render("navBarTemplate", templateData, function(err, out) {
              $('#navBar').html(out);
            });
          });

          //load nav bar template
          $.get('tl/webspec.tl', function(data) {
            var compiled = dust.compile(data, "webspecTemplate");
            dust.loadSource(compiled);

            $.ajax({
              url: 'service/projects/diagrams',
              type: 'GET',
              cache: false,
              success: function(response) {
                dust.render("webspecTemplate", response, function(err, out) {
                    $('#leftMenu').html(out);
                    
                    $('.modifyDiagram').click(function(event) {
                        var button = $(event.target);
                        var id = button.attr('diagramId');
                        $('#webspecEditor').attr('src', 'webspec/index.html?diagramId=' + id);
                    });
                });
              }
            });
            
          });
        });
    </script>
    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>

    <body>

    <!-- Nav bar -->
    <div id="navBar" class="navbar navbar-fixed-top"></div>

    <!-- Content -->
    <div class="container">
      <div id="leftMenu" class="leftMenu"></div>
      <iframe id="webspecEditor" src="webspec/index.html" class="webspecEditor"></iframe>
    </div>
  </body>
</html>